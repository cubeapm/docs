"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7814],{1443:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"instrumentation/opentelemetry/ruby-rails","title":"Ruby Rails","description":"Prerequisites","source":"@site/docs/instrumentation/opentelemetry/ruby-rails.md","sourceDirName":"instrumentation/opentelemetry","slug":"/instrumentation/opentelemetry/ruby-rails","permalink":"/instrumentation/opentelemetry/ruby-rails","draft":false,"unlisted":false,"editUrl":"https://github.com/cubeapm/docs/docs/docs/instrumentation/opentelemetry/ruby-rails.md","tags":[],"version":"current","frontMatter":{"id":"ruby-rails","title":"Ruby Rails","slug":"/instrumentation/opentelemetry/ruby-rails"},"sidebar":"tutorialSidebar","previous":{"title":"Python Sanic","permalink":"/instrumentation/opentelemetry/python-sanic"},"next":{"title":"Infra Monitoring","permalink":"/infra-monitoring"}}');var i=t(4848),l=t(8453);const s={id:"ruby-rails",title:"Ruby Rails",slug:"/instrumentation/opentelemetry/ruby-rails"},o=void 0,a={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installation",id:"installation",level:2},{value:"Sample App",id:"sample-app",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function u(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"CRuby >= 3.0, JRuby >= 9.3.2.0, or TruffleRuby >= 22.1"}),"\n",(0,i.jsx)(n.li,{children:"Bundler"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Add dependencies in Gemfile:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",children:"gem 'opentelemetry-sdk'\ngem 'opentelemetry-exporter-otlp'\ngem 'opentelemetry-instrumentation-all'\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create a file ",(0,i.jsx)(n.code,{children:"config/initializers/opentelemetry.rb"})," in your project directory, with the following content:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",metastring:'title="config/initializers/opentelemetry.rb"',children:"require 'opentelemetry/sdk'\nrequire 'opentelemetry/instrumentation/all'\nrequire 'opentelemetry-exporter-otlp'\nOpenTelemetry::SDK.configure do |c|\n    c.use_all() # enables all instrumentation!\nend\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Modify the application run command as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"OTEL_SERVICE_NAME=<app_name> \\\nOTEL_TRACES_EXPORTER=otlp \\\nOTEL_METRICS_EXPORTER=none \\\nOTEL_LOGS_EXPORTER=none \\\nOTEL_RESOURCE_ATTRIBUTES=cube.environment=UNSET,service.version=1.2.3,mykey1=myvalue1,mykey2=myvalue2 \\\nOTEL_EXPORTER_OTLP_TRACES_ENDPOINT=http://<ip_address_of_cubeapm_server>:4318/v1/traces \\\nOTEL_EXPORTER_OTLP_COMPRESSION=gzip \\\nbin/rails server\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"sample-app",children:"Sample App"}),"\n",(0,i.jsxs)(n.p,{children:["A working example is available at ",(0,i.jsx)(n.a,{href:"https://github.com/cubeapm/sample_app_ruby_rails/tree/otel",children:"https://github.com/cubeapm/sample_app_ruby_rails/tree/otel"})]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.p,{children:"The following can be used for debugging:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"OTEL_LOG_LEVEL=debug\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Also, traces exporter can be changed from ",(0,i.jsx)(n.code,{children:"otlp"})," to ",(0,i.jsx)(n.code,{children:"console"})," to output traces on console."]}),"\n",(0,i.jsx)(n.p,{children:"The following command can be tried on the application host server to check connectivity to CubeAPM server(s):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"telnet <ip_address_of_cubeapm_server> 4318\n"})})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var r=t(6540);const i={},l=r.createContext(i);function s(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);