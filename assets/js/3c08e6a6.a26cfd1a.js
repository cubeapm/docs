"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2137],{566:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>o,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"http-apis/traces","title":"Traces","description":"Ingestion (sending traces to CubeAPM)","source":"@site/docs/http-apis/traces.md","sourceDirName":"http-apis","slug":"/http-apis/traces-apis","permalink":"/http-apis/traces-apis","draft":false,"unlisted":false,"editUrl":"https://github.com/cubeapm/docs/docs/docs/http-apis/traces.md","tags":[],"version":"current","frontMatter":{"slug":"/http-apis/traces-apis"},"sidebar":"tutorialSidebar","previous":{"title":"Metrics","permalink":"/http-apis/metrics-apis"}}');var t=s(4848),d=s(8453);const i={slug:"/http-apis/traces-apis"},c="Traces",a={},l=[{value:"Ingestion (sending traces to CubeAPM)",id:"ingestion-sending-traces-to-cubeapm",level:2},{value:"Querying (fetching traces from CubeAPM)",id:"querying-fetching-traces-from-cubeapm",level:2},{value:"Traces Search API",id:"traces-search-api",level:3},{value:"Request Parameters",id:"request-parameters",level:4},{value:"curl",id:"curl",level:4},{value:"Response Format",id:"response-format",level:4},{value:"Trace Fetch API",id:"trace-fetch-api",level:3},{value:"Request Parameters",id:"request-parameters-1",level:4},{value:"curl",id:"curl-1",level:4},{value:"Response Format",id:"response-format-1",level:4}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,d.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"traces",children:"Traces"})}),"\n",(0,t.jsx)(n.h2,{id:"ingestion-sending-traces-to-cubeapm",children:"Ingestion (sending traces to CubeAPM)"}),"\n",(0,t.jsxs)(n.p,{children:["CubeAPM can receive traces from various APM agents. This makes it easy to integrate CubeAPM with a wide range of popular tools. Relevant details are available ",(0,t.jsx)(n.a,{href:"/instrumentation",children:"here"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"querying-fetching-traces-from-cubeapm",children:"Querying (fetching traces from CubeAPM)"}),"\n",(0,t.jsx)(n.h3,{id:"traces-search-api",children:"Traces Search API"}),"\n",(0,t.jsx)(n.p,{children:"Traces Search API can be used to fetch traces matching desired conditions."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Endpoint:"})," ",(0,t.jsx)(n.code,{children:"GET"})," ",(0,t.jsx)(n.code,{children:"http://<ip_address_of_cubeapm_server>:3140/api/traces/api/v1/search"})]}),"\n",(0,t.jsx)(n.h4,{id:"request-parameters",children:"Request Parameters"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"query"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"The traces query."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"env"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Environment name."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"service"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Service name."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"start"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string/integer"})}),(0,t.jsx)(n.td,{children:"Start timestamp. Can be provided either in RFC3339 format or as a Unix timestamp in seconds."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"end"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string/integer"})}),(0,t.jsx)(n.td,{children:"End timestamp. Can be provided either in RFC3339 format or as a Unix timestamp in seconds."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"limit"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"integer"})}),(0,t.jsx)(n.td,{children:"The maximum number of results to return."})]})]})]}),"\n",(0,t.jsx)(n.h4,{id:"curl",children:"curl"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"curl 'http://<ip_address_of_cubeapm_server>:3140/api/traces/api/v1/search?query=*&env=UNSET&service=order&start=1761666720&end=1761670320&limit=10'\n"})}),"\n",(0,t.jsx)(n.h4,{id:"response-format",children:"Response Format"}),"\n",(0,t.jsx)(n.p,{children:"The API returns an array of matches. Each match is a snippet of a matching trace. For large traces, the snippet may contain only a small, but relevant, portion of the trace. Each snippet has the following structure."}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"keySpanId"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Base-64 encoded ID of the span that matched the search query."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"trace"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"object"})}),(0,t.jsx)(n.td,{children:"The corresponding trace snippet."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"trace.spans"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"array"})}),(0,t.jsx)(n.td,{children:"Array of spans in the trace. Refer to the documentation of trace fetch api below for the structure of the span."})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"For example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'[\n  {\n    "keySpanId": "2d4bjpT7FaA=",\n    "trace": {\n      "spans": [\n        {\n          "trace_id": "V5OPQPPw/3hScwih8m9RBg==",\n          "span_id": "2d4bjpT7FaA=",\n          "operation_name": "POST /v1/payment",\n          "references": [\n            {\n              "trace_id": "V5OPQPPw/3hScwih8m9RBg==",\n              "span_id": "901CCWrDT6M="\n            }\n          ],\n          "start_time": "2025-10-29T03:55:04.90625352Z",\n          "duration": 40965161,\n          "tags": [\n            {\n              "key": "otel.library.name",\n              "v_str": "io.opentelemetry.tomcat-7.0"\n            },\n            {\n              "key": "http.client_ip",\n              "v_str": "13.34.54.18"\n            },\n            {\n              "key": "http.user_agent",\n              "v_str": "curl/5.0"\n            },\n            {\n              "key": "thread.id",\n              "v_type": 2,\n              "v_int64": 55\n            },\n            {\n              "key": "http.response_content_length",\n              "v_type": 2,\n              "v_int64": 2\n            },\n            {\n              "key": "http.route",\n              "v_str": "/v1/payment"\n            },\n            {\n              "key": "http.status_code",\n              "v_type": 2,\n              "v_int64": 200\n            },\n            {\n              "key": "http.method",\n              "v_str": "POST"\n            },\n            {\n              "key": "http.request_content_length",\n              "v_type": 2,\n              "v_int64": 510\n            },\n            {\n              "key": "net.host.name",\n              "v_str": "notify.cubedemo.com"\n            },\n            {\n              "key": "span.kind",\n              "v_str": "server"\n            }\n          ],\n          "logs": null,\n          "process": {\n            "service_name": "notify-service",\n            "tags": [\n              {\n                "key": "telemetry.sdk.language",\n                "v_str": "java"\n              },\n              {\n                "key": "process.pid",\n                "v_type": 2,\n                "v_int64": 1\n              },\n              {\n                "key": "cube.environment",\n                "v_str": "UNSET"\n              }\n            ]\n          }\n        }\n      ]\n    }\n  }\n]\n'})}),"\n",(0,t.jsx)(n.h3,{id:"trace-fetch-api",children:"Trace Fetch API"}),"\n",(0,t.jsxs)(n.p,{children:["Trace Fetch API can be used to fetch a single trace by its ID. Data in ",(0,t.jsx)(n.code,{children:"[start, end]"})," interval is searched to find the trace."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Endpoint:"})," ",(0,t.jsx)(n.code,{children:"GET"})," ",(0,t.jsx)(n.code,{children:"http://<ip_address_of_cubeapm_server>:3140/api/traces/api/v1/traces/<trace_id>?start=<start>&end=<end>"})]}),"\n",(0,t.jsx)(n.h4,{id:"request-parameters-1",children:"Request Parameters"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"trace_id"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Hex-encoded ID of the trace."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"start"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string/integer"})}),(0,t.jsx)(n.td,{children:"Start timestamp. Can be provided either in RFC3339 format or as a Unix timestamp in seconds."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"end"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string/integer"})}),(0,t.jsx)(n.td,{children:"End timestamp. Can be provided either in RFC3339 format or as a Unix timestamp in seconds."})]})]})]}),"\n",(0,t.jsx)(n.h4,{id:"curl-1",children:"curl"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"curl 'http://<ip_address_of_cubeapm_server>:3140/api/traces/api/v1/traces/61b66014b427bdb660622c89a29aefd1?start=1761666720&end=1761670320'\n"})}),"\n",(0,t.jsx)(n.h4,{id:"response-format-1",children:"Response Format"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"spans"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"array"})}),(0,t.jsx)(n.td,{children:"Array os spans."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"spans[].trace_id"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Base-64 encoded Trace ID."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"spans[].span_id"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Base-64 encoded Span ID."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"spans[].operation_name"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Name of span."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].references"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"array"})}),(0,t.jsx)(n.td,{children:"Array of trace references (e.g. parent). May be undefined."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].references[].trace_id"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Base-64 encoded reference Trace ID."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].references[].span_id"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Base-64 encoded reference Span ID."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].start_time"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"RFC3339 formatted start time of the span."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].duration"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"integer"})}),(0,t.jsx)(n.td,{children:"Duration of the span in nanoseconds."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].tags"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"array"})}),(0,t.jsx)(n.td,{children:"Tags (key/value pairs) associated with the span."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].tags[].key"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Name of the tag."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].tags[].v_type"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"integer"})}),(0,t.jsx)(n.td,{children:"Indicates type of value. 0 or undefined => string, 1 => bool, 2 => int64, 3 => float64, 4 => binary"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].tags[].v_str"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"String value if v_type is 0 or undefined."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].tags[].v_bool"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bool"})}),(0,t.jsx)(n.td,{children:"Boolean value if v_type is 1."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].tags[].v_int64"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"integer"})}),(0,t.jsx)(n.td,{children:"Integer value if v_type is 2."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].tags[].v_float64"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"float"})}),(0,t.jsx)(n.td,{children:"Float value if v_type is 3."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].tags[].v_binary"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Base-64 encoded binary value if v_type is 4."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].logs"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"array"})}),(0,t.jsx)(n.td,{children:"Details of exceptions associated with the span."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].logs[].timestamp"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"RFC3339 formatted timestamp of the exception."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].logs[].fields"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"array"})}),(0,t.jsx)(n.td,{children:"Details of the exception as key/value pairs."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].process.service_name"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Name of the service to which the span belongs."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"span[].process.tags"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Tags (key/value pairs) associated with the service."})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"For example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "spans": [\n    {\n      "trace_id": "YbZgFLQnvbZgYiyJoprv0Q==",\n      "span_id": "3OCKrimamF0=",\n      "operation_name": "paymentController.create",\n      "references": [\n        {\n          "trace_id": "YbZgFLQnvbZgYiyJoprv0Q==",\n          "span_id": "x9Yw4ZF4T80="\n        }\n      ],\n      "flags": 0,\n      "start_time": "2025-10-28T15:52:06.690981186Z",\n      "duration": 82337723,\n      "tags": [\n        {\n          "key": "thread.name",\n          "v_str": "http-nio-9090-exec-4"\n        },\n        {\n          "key": "otel.library.name",\n          "v_str": "io.opentelemetry.spring-webmvc-3.1"\n        },\n        {\n          "key": "otel.library.version",\n          "v_str": "1.22.1-alpha"\n        },\n        {\n          "key": "thread.id",\n          "v_type": 2,\n          "v_int64": 48\n        },\n        {\n          "key": "span.kind",\n          "v_str": "internal"\n        }\n      ],\n      "logs": null,\n      "process": {\n        "service_name": "payment-service",\n        "tags": [\n          {\n            "key": "host.name",\n            "v_str": "ip-10-0-129-151"\n          },\n          {\n            "key": "process.pid",\n            "v_type": 2,\n            "v_int64": 1\n          },\n          {\n            "key": "telemetry.sdk.language",\n            "v_str": "java"\n          },\n          {\n            "key": "cube.environment",\n            "v_str": "UNSET"\n          }\n        ]\n      }\n    }\n  ]\n}\n'})})]})}function o(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var r=s(6540);const t={},d=r.createContext(t);function i(e){const n=r.useContext(d);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);