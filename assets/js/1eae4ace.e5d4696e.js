"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3262],{1470:(e,s,r)=>{r.d(s,{A:()=>S});var n=r(6540),i=r(8215),t=r(3104),o=r(6347),l=r(205),a=r(7485),c=r(1682),d=r(679);function h(e){return n.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:s}=e;return!!s&&"object"==typeof s&&"value"in s}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:s,children:r}=e;return(0,n.useMemo)((()=>{const e=s??function(e){return h(e).map((e=>{let{props:{value:s,label:r,attributes:n,default:i}}=e;return{value:s,label:r,attributes:n,default:i}}))}(r);return function(e){const s=(0,c.XI)(e,((e,s)=>e.value===s.value));if(s.length>0)throw new Error(`Docusaurus error: Duplicate values "${s.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[s,r])}function g(e){let{value:s,tabValues:r}=e;return r.some((e=>e.value===s))}function p(e){let{queryString:s=!1,groupId:r}=e;const i=(0,o.W6)(),t=function(e){let{queryString:s=!1,groupId:r}=e;if("string"==typeof s)return s;if(!1===s)return null;if(!0===s&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:s,groupId:r});return[(0,a.aZ)(t),(0,n.useCallback)((e=>{if(!t)return;const s=new URLSearchParams(i.location.search);s.set(t,e),i.replace({...i.location,search:s.toString()})}),[t,i])]}function m(e){const{defaultValue:s,queryString:r=!1,groupId:i}=e,t=u(e),[o,a]=(0,n.useState)((()=>function(e){let{defaultValue:s,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(s){if(!g({value:s,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${s}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return s}const n=r.find((e=>e.default))??r[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:s,tabValues:t}))),[c,h]=p({queryString:r,groupId:i}),[m,f]=function(e){let{groupId:s}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(s),[i,t]=(0,d.Dv)(r);return[i,(0,n.useCallback)((e=>{r&&t.set(e)}),[r,t])]}({groupId:i}),x=(()=>{const e=c??m;return g({value:e,tabValues:t})?e:null})();(0,l.A)((()=>{x&&a(x)}),[x]);return{selectedValue:o,selectValue:(0,n.useCallback)((e=>{if(!g({value:e,tabValues:t}))throw new Error(`Can't select invalid tab value=${e}`);a(e),h(e),f(e)}),[h,f,t]),tabValues:t}}var f=r(2303);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=r(4848);function v(e){let{className:s,block:r,selectedValue:n,selectValue:o,tabValues:l}=e;const a=[],{blockElementScrollPositionUntilNextRender:c}=(0,t.a_)(),d=e=>{const s=e.currentTarget,r=a.indexOf(s),i=l[r].value;i!==n&&(c(s),o(i))},h=e=>{let s=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const r=a.indexOf(e.currentTarget)+1;s=a[r]??a[0];break}case"ArrowLeft":{const r=a.indexOf(e.currentTarget)-1;s=a[r]??a[a.length-1];break}}s?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":r},s),children:l.map((e=>{let{value:s,label:r,attributes:t}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:n===s?0:-1,"aria-selected":n===s,ref:e=>{a.push(e)},onKeyDown:h,onClick:d,...t,className:(0,i.A)("tabs__item",x.tabItem,t?.className,{"tabs__item--active":n===s}),children:r??s},s)}))})}function b(e){let{lazy:s,children:r,selectedValue:t}=e;const o=(Array.isArray(r)?r:[r]).filter(Boolean);if(s){const e=o.find((e=>e.props.value===t));return e?(0,n.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:o.map(((e,s)=>(0,n.cloneElement)(e,{key:s,hidden:e.props.value!==t})))})}function A(e){const s=m(e);return(0,j.jsxs)("div",{className:(0,i.A)("tabs-container",x.tabList),children:[(0,j.jsx)(v,{...s,...e}),(0,j.jsx)(b,{...s,...e})]})}function S(e){const s=(0,f.A)();return(0,j.jsx)(A,{...e,children:h(e.children)},String(s))}},7735:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/aws-firehose-flow-333015adc7a8ad638e077bd725b05a37.svg"},8453:(e,s,r)=>{r.d(s,{R:()=>o,x:()=>l});var n=r(6540);const i={},t=n.createContext(i);function o(e){const s=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(t.Provider,{value:s},e.children)}},9265:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>d,contentTitle:()=>c,default:()=>g,frontMatter:()=>a,metadata:()=>n,toc:()=>h});const n=JSON.parse('{"id":"logs/ingestion/aws-firehose","title":"AWS Firehose","description":"CubeAPM supports collecting logs from AWS services through Amazon Data Firehose. AWS services can send logs through two primary paths:","source":"@site/docs/logs/ingestion/aws-firehose.md","sourceDirName":"logs/ingestion","slug":"/logs/ingestion/aws-firehose","permalink":"/logs/ingestion/aws-firehose","draft":false,"unlisted":false,"editUrl":"https://github.com/cubeapm/docs/docs/docs/logs/ingestion/aws-firehose.md","tags":[],"version":"current","frontMatter":{"id":"aws-firehose","title":"AWS Firehose","slug":"/logs/ingestion/aws-firehose"},"sidebar":"tutorialSidebar","previous":{"title":"AWS ECS","permalink":"/logs/ingestion/aws-ecs"},"next":{"title":"AWS Lambda","permalink":"/logs/ingestion/aws-lambda"}}');var i=r(4848),t=r(8453),o=r(1470),l=r(9365);const a={id:"aws-firehose",title:"AWS Firehose",slug:"/logs/ingestion/aws-firehose"},c="AWS Logs via Firehose",d={},h=[{value:"Setup Instructions",id:"setup-instructions",level:2},{value:"Step 1: Create Amazon Data Firehose Stream",id:"step-1-create-amazon-data-firehose-stream",level:3},{value:"Step 2: Configure IAM Permissions",id:"step-2-configure-iam-permissions",level:3},{value:"Step 3: Configure Log Source",id:"step-3-configure-log-source",level:3},{value:"Required IAM Permissions for Subscription Filter",id:"required-iam-permissions-for-subscription-filter",level:4},{value:"Configure CloudWatch Logs Subscription Filter",id:"configure-cloudwatch-logs-subscription-filter",level:4},{value:"Required IAM Permissions for AWS Services",id:"required-iam-permissions-for-aws-services",level:4},{value:"Configure AWS Service for Direct Delivery",id:"configure-aws-service-for-direct-delivery",level:4},{value:"Troubleshooting",id:"troubleshooting",level:2}];function u(e){const s={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"aws-logs-via-firehose",children:"AWS Logs via Firehose"})}),"\n",(0,i.jsx)(s.p,{children:"CubeAPM supports collecting logs from AWS services through Amazon Data Firehose. AWS services can send logs through two primary paths:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"AWS Services \u2192 CloudWatch Logs \u2192 Firehose \u2192 CubeAPM"})," - Most AWS services (e.g., AWS Lambda, API Gateway, EC2) send their logs to CloudWatch Logs first, which can then be forwarded to Firehose."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"AWS CloudWatch Firehose Log Flow",src:r(9958).A+"",width:"759",height:"92"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"AWS Services \u2192 Firehose \u2192 CubeAPM"})," - Some AWS services (e.g., AWS WAF) can send logs directly to Firehose, bypassing CloudWatch Logs entirely."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"AWS CloudWatch Firehose Log Flow",src:r(7735).A+"",width:"557",height:"92"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"setup-instructions",children:"Setup Instructions"}),"\n",(0,i.jsx)(s.h3,{id:"step-1-create-amazon-data-firehose-stream",children:"Step 1: Create Amazon Data Firehose Stream"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Go to AWS Console and navigate to ",(0,i.jsx)(s.strong,{children:"Amazon Data Firehose"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Click ",(0,i.jsx)(s.strong,{children:"Create Firehose stream"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Configure the basic settings:","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Source"}),": Choose ",(0,i.jsx)(s.strong,{children:"Direct PUT"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Destination"}),": Choose ",(0,i.jsx)(s.strong,{children:"HTTP Endpoint"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Firehose stream name"}),": Give an appropriate name (e.g., ",(0,i.jsx)(s.code,{children:"CubeAPM-Logs-Stream"}),")"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Transform records"})," (optional): Leave blank or skip this step"]}),"\n",(0,i.jsxs)(s.li,{children:["Configure ",(0,i.jsx)(s.strong,{children:"Destination settings"}),":","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"HTTP endpoint name"}),": Provide a descriptive name (e.g., ",(0,i.jsx)(s.code,{children:"CubeAPM-Logs-Endpoint"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"HTTP endpoint URL"}),": ",(0,i.jsx)(s.code,{children:"https://<cubeapm_domain>:3130/api/logs/firehose/generic"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Authentication"}),": Choose ",(0,i.jsx)(s.strong,{children:"Use access key"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Access key"})," (optional): Leave blank"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Content encoding"}),": Select ",(0,i.jsx)(s.strong,{children:"GZIP"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Parameters"}),": Click ",(0,i.jsx)(s.strong,{children:"Add parameter"})," and add:","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Parameter name"}),": ",(0,i.jsx)(s.code,{children:"event.domain"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Parameter value"}),": ",(0,i.jsx)(s.code,{children:"aws.firehose"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.admonition,{type:"info",children:[(0,i.jsx)(s.p,{children:"For multi-environment setup, you can add additional parameters to identify the environment:"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Parameter name"}),": ",(0,i.jsx)(s.code,{children:"cube.environment"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Parameter value"}),": ",(0,i.jsx)(s.code,{children:"<environment_name>"})]}),"\n"]})]}),"\n",(0,i.jsx)(s.h3,{id:"step-2-configure-iam-permissions",children:"Step 2: Configure IAM Permissions"}),"\n",(0,i.jsxs)(s.p,{children:["After creating the stream, go to the ",(0,i.jsx)(s.strong,{children:"Configuration"})," tab and configure ",(0,i.jsx)(s.strong,{children:"Service access"}),":"]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Under ",(0,i.jsx)(s.strong,{children:"Service access"}),", ensure the IAM role has the required permissions"]}),"\n",(0,i.jsx)(s.li,{children:"Create an IAM role for Firehose with the following trust policy:"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Sid": "firehoseAssume",\n      "Effect": "Allow",\n      "Principal": {\n        "Service": "firehose.amazonaws.com"\n      },\n      "Action": "sts:AssumeRole",\n      "Condition": {\n        "ArnEquals": {\n          "aws:SourceArn": "arn:aws:firehose:region:account-id:deliverystream/your-firehose-stream-name"\n        }\n      }\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(s.h3,{id:"step-3-configure-log-source",children:"Step 3: Configure Log Source"}),"\n",(0,i.jsx)(s.p,{children:"Choose the appropriate method based on your AWS service:"}),"\n","\n",(0,i.jsxs)(o.A,{children:[(0,i.jsxs)(l.A,{value:"cloudwatch",label:"Via CloudWatch Logs",default:!0,children:[(0,i.jsx)(s.p,{children:"Most AWS services (e.g., AWS Lambda, API Gateway, EC2) send their logs to CloudWatch Logs first. Follow these steps to forward logs from CloudWatch to Firehose:"}),(0,i.jsx)(s.h4,{id:"required-iam-permissions-for-subscription-filter",children:"Required IAM Permissions for Subscription Filter"}),(0,i.jsx)(s.p,{children:"The subscription filter requires permission to deliver logs to Firehose:"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Action": ["firehose:PutRecord", "firehose:PutRecordBatch"],\n      "Resource": "arn:aws:firehose:*:*:deliverystream/your-firehose-stream-name"\n    }\n  ]\n}\n'})}),(0,i.jsx)(s.h4,{id:"configure-cloudwatch-logs-subscription-filter",children:"Configure CloudWatch Logs Subscription Filter"}),(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Go to ",(0,i.jsx)(s.strong,{children:"AWS Console"})," \u2192 ",(0,i.jsx)(s.strong,{children:"CloudWatch"})," \u2192 ",(0,i.jsx)(s.strong,{children:"Logs"})," \u2192 ",(0,i.jsx)(s.strong,{children:"Log groups"})]}),"\n",(0,i.jsx)(s.li,{children:"Find the log group for your AWS service"}),"\n",(0,i.jsxs)(s.li,{children:["Click on the log group and go to ",(0,i.jsx)(s.strong,{children:"Subscription filters"})]}),"\n",(0,i.jsxs)(s.li,{children:["Click ",(0,i.jsx)(s.strong,{children:"Create subscription filter"})]}),"\n",(0,i.jsxs)(s.li,{children:["Configure the subscription filter:","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Destination"}),": Choose ",(0,i.jsx)(s.strong,{children:"Amazon Data Firehose"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Amazon Data Firehose stream"}),": Select the Firehose stream created in Step 1"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Subscription filter pattern"}),": Leave empty to send all logs, or add a pattern to filter specific logs"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Subscription filter name"}),": Give an appropriate name"]}),"\n"]}),"\n"]}),"\n"]})]}),(0,i.jsxs)(l.A,{value:"direct",label:"Direct to Firehose",children:[(0,i.jsx)(s.p,{children:"Some AWS services (e.g., AWS WAF) can send logs directly to Firehose, bypassing CloudWatch Logs entirely:"}),(0,i.jsx)(s.h4,{id:"required-iam-permissions-for-aws-services",children:"Required IAM Permissions for AWS Services"}),(0,i.jsx)(s.p,{children:"For services like AWS WAF that send logs directly to Firehose, ensure the service has permission to write to your Firehose stream. This is typically configured automatically when you set up logging in the service console."}),(0,i.jsx)(s.h4,{id:"configure-aws-service-for-direct-delivery",children:"Configure AWS Service for Direct Delivery"}),(0,i.jsx)(s.p,{children:"Configure your AWS service to send logs directly to the Firehose stream:"}),(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"For AWS WAF:"})}),(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Go to ",(0,i.jsx)(s.strong,{children:"AWS Console"})," \u2192 ",(0,i.jsx)(s.strong,{children:"WAF & Shield"})," \u2192 ",(0,i.jsx)(s.strong,{children:"Web ACLs"})]}),"\n",(0,i.jsx)(s.li,{children:"Select your Web ACL"}),"\n",(0,i.jsxs)(s.li,{children:["Go to ",(0,i.jsx)(s.strong,{children:"Logging and metrics"})," tab"]}),"\n",(0,i.jsx)(s.li,{children:"Enable logging and select the Firehose stream as the destination"}),"\n"]})]})]}),"\n",(0,i.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Check Firehose Stream Metrics"}),":"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Go to AWS Console \u2192 Amazon Data Firehose \u2192 Your stream"}),"\n",(0,i.jsxs)(s.li,{children:["Check the ",(0,i.jsx)(s.strong,{children:"Monitoring"})," tab for metrics on data received and delivered"]}),"\n",(0,i.jsxs)(s.li,{children:["Check ",(0,i.jsx)(s.strong,{children:"Error logs"})," tab for destination error logs and detailed error messages"]}),"\n"]}),"\n"]}),"\n"]})]})}function g(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},9365:(e,s,r)=>{r.d(s,{A:()=>o});r(6540);var n=r(8215);const i={tabItem:"tabItem_Ymn6"};var t=r(4848);function o(e){let{children:s,hidden:r,className:o}=e;return(0,t.jsx)("div",{role:"tabpanel",className:(0,n.A)(i.tabItem,o),hidden:r,children:s})}},9958:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/aws-cloudwatch-firehose-flow-94be38807e838d90a2eaa5a3ac32d1ee.svg"}}]);